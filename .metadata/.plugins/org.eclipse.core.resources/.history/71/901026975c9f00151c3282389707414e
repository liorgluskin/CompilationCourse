package semantic;


import slp.*;
import symbolTableHandler.*;
import types.TypeTable;

public class SemanticEvaluator implements Visitor{
	private Boolean hasMain = false;
	private GlobalSymbolTable global = null;

	
	public SemanticEvaluator(){
		TypeTable.initTypeTable();
	}
	
	public GlobalSymbolTable getSymbolTable(Program program){
		program.accept(this);
		return global;
	}
	
	private void addStaticLibraryClass(){
		if(global == null){
			global = new GlobalSymbolTable();
		}
		//creating all methods
		
		//adding Library class to global scope
		global.addClass(new Clas);
	}


	@Override
	public void visit(Program program){
		global = new GlobalSymbolTable();
		// add classes to global and updates the type table
		for (ClassDecl c: program.getClasses()){
			try{
				global.addClass(c);
			} catch (SemanticError se){
				// class is previously defined or super class is not defined
				se.setLineNum(c.getLineNum());
				System.err.println(se);
				System.exit(-1);
			}
		}
		
		// recursive class symbol tables build
		for (ClassDecl c: program.getClasses()){
			// set enclosing scope
			c.setEnclosingScope(global);
			c.accept(this);
		}
		
		// check if has main method
		if (!hasMain){
			System.err.println(new SemanticError("Program has no main method",0));
			System.exit(-1);
		}
	}


	@Override
	public void visit(ClassDecl class_decl) {
		
		//create symbol table for class 
		ClassSymbolTable cst;		
		if (class_decl.getSuperClassName() != null) {
			ClassSymbolTable  scst = global.getClassSymbolTable(class_decl.getSuperClassName());
			cst = new ClassSymbolTable( scst, global.getClass(class_decl.getName()) );
			scst.addClassSymbolTable(cst);
		} else { // no superclass
			cst = new ClassSymbolTable(global,global.getClass(class_decl.getName()));
			global.addClassSymbolTable(cst);;
		}
		
		
		
		//create symbol table for methods 
		for( FieldOrMethod fom: class_decl.getFieldsOrMethods()){
			fom.setEnclosingScope(cst);
			
		}
		
		
		
		
		//fields and methods check
	}


	@Override
	public void visit(ClassMethod method) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(StaticMethod method) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(PrimitiveType primitiveType) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(ClassType classType) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Field field) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Formal formal) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(StmtList stmts) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Stmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(AssignStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(CallStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(ReturnStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(IfStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(WhileStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(BreakStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(ContinueStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(BlockStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(IDStmt stmt) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(VarLocation var_loc) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(ArrLocation arr_loc) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(StaticCall static_call) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(VirtualCall virtual_call) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Literal literal) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(This t) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(NewObject new_obj) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(NewArray new_arr) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Length length) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(Expr expr) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(BlockExpr expr) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(UnaryOpExpr expr) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public void visit(BinaryOpExpr expr) {
		// TODO Auto-generated method stub
		
	}
}
